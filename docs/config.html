<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuring a Fitting Job &#8212; PyBNF v0.3.1 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     'v0.3.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration Keys" href="config_keys.html" />
    <link rel="prev" title="Quick Start" href="quickstart.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="config_keys.html" title="Configuration Keys"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="quickstart.html" title="Quick Start"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyBNF v0.3.1 documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/LogoSm.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Configuring a Fitting Job</a><ul>
<li><a class="reference internal" href="#the-configuration-file">The Configuration File</a></li>
<li><a class="reference internal" href="#model-files">Model Files</a><ul>
<li><a class="reference internal" href="#bionetgen">BioNetGen</a></li>
<li><a class="reference internal" href="#sbml">SBML</a></li>
</ul>
</li>
<li><a class="reference internal" href="#experimental-data-files">Experimental Data Files</a></li>
<li><a class="reference internal" href="#constraint-files">Constraint files</a><ul>
<li><a class="reference internal" href="#inequality">Inequality</a></li>
<li><a class="reference internal" href="#enforcement">Enforcement</a></li>
<li><a class="reference internal" href="#weight">Weight</a></li>
<li><a class="reference internal" href="#constraints-involving-multiple-models">Constraints involving multiple models</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="quickstart.html"
                        title="previous chapter">Quick Start</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="config_keys.html"
                        title="next chapter">Configuration Keys</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/config.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuring-a-fitting-job">
<span id="config"></span><h1>Configuring a Fitting Job<a class="headerlink" href="#configuring-a-fitting-job" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-configuration-file">
<h2>The Configuration File<a class="headerlink" href="#the-configuration-file" title="Permalink to this headline">¶</a></h2>
<p>The configuration file is a plain text file with the extension “.conf” that specifies all of the information that PyBNF needs to perform the fitting: the location of the model and data files, and the details of the fitting algorithm to be run.</p>
<p>Several examples of .conf files are included in the examples/ folder.</p>
<p>Each line of a conf file has the general format config_key=value, which assigns the configuration key “config_key” to the value “value”.</p>
<p>The available configuration keys to be specified are detailed in <a class="reference internal" href="config_keys.html#config-keys"><span class="std std-ref">Configuration Keys</span></a>.</p>
</div>
<div class="section" id="model-files">
<h2>Model Files<a class="headerlink" href="#model-files" title="Permalink to this headline">¶</a></h2>
<div class="section" id="bionetgen">
<h3>BioNetGen<a class="headerlink" href="#bionetgen" title="Permalink to this headline">¶</a></h3>
<p>BioNetGen models are specified in plain text files written in BioNetGen language (BNGL). Documentation for BNGL can be found at <a class="reference external" href="http://www.csb.pitt.edu/Faculty/Faeder/?page_id=409">http://www.csb.pitt.edu/Faculty/Faeder/?page_id=409</a>.</p>
<p>Two small modifications of a BioNetGen-compatible BNGL file are necessary to use the file with PyBNF</p>
<ol class="arabic simple">
<li>Replace each value to be fit with a name that ends in the string “__FREE”.</li>
</ol>
<p>For example, if the parameters block in our original file was the following:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>begin parameters

    v1 17
    v2 42
    v3 37
    NA 6.02e23

end parameters
</pre></div>
</div>
<p>the revised version for PyBNF should look like:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>begin parameters

    v1 v1__FREE
    v2 v2__FREE
    v3 v3__FREE
    NA 6.02e23

end parameters
</pre></div>
</div>
<p>We have replaced each fixed parameter value in the original file with a “FREE” parameter to be fit. Parameters that we do not want to fit (such as the physical constant NA) are left as is.</p>
<ol class="arabic simple" start="2">
<li>Use the “suffix” argument to create a correspondence between your simulation command and your experimental data file.</li>
</ol>
<p>For example, if your simulation call <code class="docutils literal"><span class="pre">simulate({method=&gt;”ode”})</span></code> generates data to be fit using the data file data1.exp, you should edit your call to <code class="docutils literal"><span class="pre">simulate({method=&gt;”ode”,</span> <span class="pre">suffix=&gt;”data1”})</span></code>.</p>
</div>
<div class="section" id="sbml">
<h3>SBML<a class="headerlink" href="#sbml" title="Permalink to this headline">¶</a></h3>
<p>SBML files can be used with PyBNF as is, with no modifications required. PyBNF will match parameter names given in the configuration file, with the IDs of parameters or species in the SBML file. If the name of a species is given, PyBNF fits for the initial concentration of that species.</p>
<p>PyBNF assumes that any parameters and species that are not named in the config file are not meant to be fit - such values are held constant at the value specified in the SBML file.</p>
<p>To avoid mistakes in configuration, you may optionally append “__FREE” to the names of parameters to be fit, as with BioNetGen models. PyBNF will raise an error if it finds a parameter ending in “__FREE” in the SBML that is not specified in the configuration file.</p>
<p>Caution: If you are using <a class="reference external" href="http://copasi.org/">COPASI</a> to export SBML files, renaming a parameter is not straightforward. Typically, renaming a parameter only changes its <code class="docutils literal"><span class="pre">name</span></code> field, but PyBNF reads the <code class="docutils literal"><span class="pre">id</span></code> field.</p>
<p>Note that SBML files do not contain information about what time course or parameter scan simulations should be run on the model. Therefore, when using SBML files, it is required to specify this information in the configuration file with the <a class="reference internal" href="config_keys.html#time-course-key"><span class="std std-ref">time_course</span></a> and <a class="reference internal" href="config_keys.html#param-scan-key"><span class="std std-ref">param_scan</span></a> keys.</p>
</div>
</div>
<div class="section" id="experimental-data-files">
<span id="exp-file"></span><h2>Experimental Data Files<a class="headerlink" href="#experimental-data-files" title="Permalink to this headline">¶</a></h2>
<p>Experimental data file are plain text files with the extension “.exp” that contain whitespace-delimited tables of data to be used for fitting.</p>
<p>The first line of the .exp file is the header. It should contain the character #, followed by the names of each column. The first column name should be the name of the independent variable (e.g. “time” for a time course simulation). The rest of the column names should match the names of observables in a BNGL file, or species in an SBML file. The following lines should contain data, with numbers separated by whitespace. Use “nan” to indicate missing data. Here is a simple example of an exp file. In this case, the corresponding BNGL file should contain observables named X and Y:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>#    time    X    Y
    0    5    1e4
    5    7    1.5e4
    10    9    4e4
    15    nan    6.5e4
    20    15    1.1e5
</pre></div>
</div>
<p>If your are fitting with the chi-squared objective function, you also need to provide a standard deviation for each experimental data point. To do so, include a column in the .exp file with &#8220;_SD&#8221; appended to the variable name. For example:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>#    time    X    Y        X_SD    Y_SD
    0    5    1e4        1    2e2
    5    7    1.5e4    1.2    2e2
    10    9    4e4        1.4    4e2
    15    nan    6.5e4    nan    5e2
    20    15    1.1e5    0.9    5e2
</pre></div>
</div>
</div>
<div class="section" id="constraint-files">
<span id="con-file"></span><h2>Constraint files<a class="headerlink" href="#constraint-files" title="Permalink to this headline">¶</a></h2>
<p>Constraint files are plain text files with the extension &#8221;.con&#8221; that contain inequality constraints to be imposed on the outputs of the model. Such constraints can be used to formalize qualitative data known about the biological system of interest.</p>
<p>Each line of the .con file should contain constraint declaration consisting of three parts: an inequality to be satisfied, an enforcement condition that specifies when in the simulation time course the constraint is applied, and a weight that controls the penalty to add to the objective function if the constraint is not satisfied. Specifically, if a constraint of the form <img class="math" src="_images/math/6783d80a735d5d2e27cb16aff6d2c0523f1ae731.png" alt="A&lt;B"/> with weight <img class="math" src="_images/math/ecd1ee2a1cd226b40c37e079aca62398d4b774f5.png" alt="w"/> is violated, then the value added to the objective function is <img class="math" src="_images/math/7de9c5b89ab946031b03e033bbebb4b37f96b51e.png" alt="w*(A-B)"/>.</p>
<p>The weight may be omitted and defaults to 1. The inequality and enforcement clauses are required</p>
<div class="section" id="inequality">
<h3>Inequality<a class="headerlink" href="#inequality" title="Permalink to this headline">¶</a></h3>
<p>The inequality can consist of any relationship (&lt;, &gt;, &lt;=, or &gt;=) between two observables, or between one observable and a constant. For example <code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span></code> , or <code class="docutils literal"><span class="pre">A</span> <span class="pre">&gt;=</span> <span class="pre">B</span></code>.
Note that &lt; and &lt;= are equivalent unless the <code class="docutils literal"><span class="pre">min</span></code> keyword is used (see <a class="reference internal" href="#weight">Weight</a>).</p>
</div>
<div class="section" id="enforcement">
<h3>Enforcement<a class="headerlink" href="#enforcement" title="Permalink to this headline">¶</a></h3>
<p>Four keywords are available to specify when the inequality is enforced.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">always</span></code> - Enforce the inequality at all time points during the simulation.</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">always</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">once</span></code> - Require that the inequality be true at at least one time point during the simulation.
<code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">once</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">at</span></code> - Enforce the inequality at one specific time point. This could be a constant time point:</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">6</span></code> or equivalently, <code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">time=6</span></code></p>
<p>It is also possible to specify the time point in terms of another observable.</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">B=6</span></code> - Enforce the inequality at the first time point such that B=6 (more exactly, the first time such that B crosses the value of 6 between two consecutive time steps)</p>
<p>Using similar syntax, we can specify that the constraint is enforced at every time B=6, not just the first, using the <code class="docutils literal"><span class="pre">everytime</span></code> keyword</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">B=6</span> <span class="pre">everytime</span></code></p>
<p>The <code class="docutils literal"><span class="pre">first</span></code> keyword says that the constraint should only (this is the default behavior, so this keyword is optional)</p>
<p><code class="docutils literal"><span class="pre">A&lt;5</span> <span class="pre">at</span> <span class="pre">B=6</span> <span class="pre">first</span></code></p>
<p>If the specified condition (B=6 in the example) is never met, then the constraint is not applied. It is often useful to add a second constraint to ensure that an &#8220;at&#8221; constraint is enforced. In this example, assuming the initial value of B is below 6, we could add the constraint <code class="docutils literal"><span class="pre">B&gt;=6</span> <span class="pre">once</span></code></p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">between</span></code> - Enforce the inequality at all times between the two specified time points. The time points may be specified in the same format as with the at keyword above, and should be separated by a comma.</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">between</span> <span class="pre">7,</span> <span class="pre">B=6</span></code> would enforce the inequality from time=7 to the first time after time=7 such that B=6.</p>
<p>If the first condition (time=7 in the example) is never met, then the constraint is never enforced. If the second condition (B=6 in the example) is never met, then the constraint is enforced from the start time until the end of the simulation.</p>
</li>
</ul>
</div>
<div class="section" id="weight">
<h3>Weight<a class="headerlink" href="#weight" title="Permalink to this headline">¶</a></h3>
<p>The weight clause consists of the <code class="docutils literal"><span class="pre">weight</span></code> keyword followed by a number. This number is multiplied by the extent of constraint violation to give the value to be added to the objective function. For example:</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">6</span> <span class="pre">weight</span> <span class="pre">2</span></code></p>
<p>If the inequality A &lt; 5 is not satisfied at time 6, then a penalty of 2*(A-5) is added to the objective function.</p>
<p>The <code class="docutils literal"><span class="pre">min</span></code> keyword indicates the minimum possible penalty to apply if the constraint is violated. This minimum is still multiplied by the constraint weight.</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">6</span> <span class="pre">weight</span> <span class="pre">2</span> <span class="pre">min</span> <span class="pre">4</span></code></p>
<p>If the inequality A &lt; 5 is not satisfied at time 6, the penalty is <img class="math" src="_images/math/a9910f3d0f0b82fe58ae77ba19944bb6b84bb9f3.png" alt="2*\textrm{max}((A-5), 4)"/>. Since we used the strict &lt; operator, the minimum penalty of 8 is applied even if A=5 at time 6.</p>
<p>In some unusual cases, it is desirable to use a different observable for calculating penalties than the one used in the inequality. For example, the variable in the inequality might be a discrete variable, and it would be desirable to calculate the penalty with a corresponding continuous variable. This substitution may be made using the <code class="docutils literal"><span class="pre">altpenalty</span></code> keyword in the weight clause, followed by the new inequality to use for calculating the penalty.</p>
<p><code class="docutils literal"><span class="pre">A</span> <span class="pre">&lt;</span> <span class="pre">5</span> <span class="pre">at</span> <span class="pre">B=3</span> <span class="pre">weight</span> <span class="pre">10</span> <span class="pre">altpenalty</span> <span class="pre">A2&lt;4</span> <span class="pre">min</span> <span class="pre">1</span></code></p>
<p>This constraint would check if A&lt;5 when B reaches 3. If A &gt;= 5 at that time, it instead calculates the penalty based on the inequality A2&lt;4 with a weight of 10: <img class="math" src="_images/math/0baa767cbaafcae14f46188bc7825a595cf03ea2.png" alt="10*\textrm{max}(0, A2-4)"/>. If the initial inequality is violated but the penalty inequality is satisfied, then the penalty is equal to the weight times the min value (10*1 in the example), or zero if no min was declared.</p>
</div>
<div class="section" id="constraints-involving-multiple-models">
<h3>Constraints involving multiple models<a class="headerlink" href="#constraints-involving-multiple-models" title="Permalink to this headline">¶</a></h3>
<p>By default, observables in constraint files are assumed to come from the model that the .con file is mapped to, and the simulation suffix matching the .con file&#8217;s name (the same convention as for .exp files). However, it is possible to use &#8220;dot notation&#8221; to refer to observables in other simulations, as in the following example.</p>
<p>fit.conf:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>model = model1.bngl : wt.exp
model = model2.bngl : mut.con
</pre></div>
</div>
<p>mut.con:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>A &lt; wt.A always
</pre></div>
</div>
<p>In this example, the constraint would check that the value of <code class="docutils literal"><span class="pre">A</span></code> in the simulation of model2 with suffix &#8220;mut&#8221; is less than the value of <code class="docutils literal"><span class="pre">A</span></code> in the simulation of model1 with suffix &#8220;wt&#8221;. In this way, it is possible to write constraints involving the outputs of multiple models.</p>
<p>To use this feature, all simulation suffixes must be unique across all models. In addition all observables used in a single constraint must have the same independent variable with the same step size.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="config_keys.html" title="Configuration Keys"
             >next</a> |</li>
        <li class="right" >
          <a href="quickstart.html" title="Quick Start"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">PyBNF v0.3.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Ryan Suderman, Eshan Mitra.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.5.6.
    </div>
  </body>
</html>